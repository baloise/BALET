SetKlassen();var today=new Date();var todayFormatted=today.getDate()+"-"+(today.getMonth()+1)+"-"+today.getFullYear();var thisWeek=moment(todayFormatted,"DD-MM-YYYY").week();var thisWeekAndYear=thisWeek+"-"+today.getFullYear();$("#weekchangerDateNum").html(thisWeekAndYear);function SetKlassen(){$("#k_auswahl").empty();$.getJSON("https://sandbox.gibm.ch/klassen.php","beruf_id=10",function(a){$("#k_auswahl").append($("<option>",{text:"-"}));$.each(a,function(b,c){$("#k_auswahl").append($("<option/>",{value:c.klasse_id,text:c.klasse_longname}))});$("#klasse_Dropdown").fadeIn()})}function setKalender(){$("#tafel_content").empty();$("#meldung").remove();var b=$("#k_auswahl").val();if(!b){b=$("#k_auswahl").attr("value")}var a=["So","Mo","Di","Mi","Do","Fr","Sa"];$("#weekchangerDateNum").html(thisWeekAndYear);if(b>=0&&b!==""){$.getJSON("https://sandbox.gibm.ch/tafel.php?klasse_id="+b+"&woche="+thisWeekAndYear,function(c){if(c!=""){$.each(c,function(d,f){var e='<tr><td class="agenda-date" class="active" rowspan="1"> <div class="dayofmonth">'+a[f.tafel_wochentag]+'</div><div class="dayofweek"></div><div class="shortdate text-muted">'+f.tafel_datum+'</div></td><td class="agenda-time"> '+f.tafel_von+" - "+f.tafel_bis+' </td><td class="agenda-events"><div class="agenda-event">'+f.tafel_longfach+'</div></td><td class="agenda-events"><div class="agenda-event">'+f.tafel_raum+'</div></td><td class="agenda-events"><div class="agenda-event">'+f.tafel_lehrer+"</div></td></tr>";$("#tafel_content").append(e);$("#k_auswahl").val(b)})}else{$("#kalender_tafel").fadeTo("fast",0);$("#kalender_tafel").after('<p id="meldung">'+translate[167]+"?</p>")}}).fail(function(c,e,d){alert(translate[157]+": "+e)})}$(".weekchanger").fadeTo("fast",1);$("#kalender_tafel").fadeTo("fast",1)}$("#b_auswahl").change(function(){if(this.value!==""){SetKlassen();$("#klassenauswahl").fadeTo("fast",1);$(".weekchanger").fadeTo("fast",0);$("#kalender_tafel").fadeTo("fast",0)}else{$("#klassenauswahl").fadeTo("fast",0);$(".weekchanger").fadeTo("fast",0);$("#kalender_tafel").fadeTo("fast",0)}});$("#klassenauswahl").change(function(){if(this.value!==""){$("#saveClassButton").slideDown("slow");thisWeekAndYear=thisWeek+"-"+today.getFullYear();setKalender();document.cookie="beruf="+$("#b_auswahl").val();document.cookie="klasse="+$("#k_auswahl").val();$("#stundenplan").fadeTo("fast",1)}else{$(".weekchanger").fadeTo("fast",0);$("#kalender_tafel").fadeTo("fast",0)}});$(".weekchangerNext").on("click",function(){var b=$("#weekchangerDateNum").html();var c=b.split("-")[0];if(c=="52"){var a=parseInt(b.split("-")[1])+1;b="1-"+a}else{c=parseInt(c)+1;b=c+"-"+b.split("-")[1]}$("#weekchangerDateNum").html(b);thisWeekAndYear=b;setKalender()});$(".weekchangerBefore").on("click",function(){var b=$("#weekchangerDateNum").html();var c=b.split("-")[0];if(c=="1"){var a=parseInt(b.split("-")[1])-1;b="52-"+a}else{c=parseInt(c)-1;b=c+"-"+b.split("-")[1]}$("#weekchangerDateNum").html(b);thisWeekAndYear=b;setKalender()});$(document).ready(function(){if($("#k_auswahl").attr("value")){$("#k_auswahl").val($("#k_auswahl").attr("value"));thisWeekAndYear=thisWeek+"-"+today.getFullYear();document.cookie="beruf="+$("#b_auswahl").val();document.cookie="klasse="+$("#k_auswahl").val();setKalender();$("#stundenplan").fadeTo("fast",1)}$("#saveClassButton").click(function(){var a="";var b=$("#k_auswahl").val();if(!b&&b!="-"){a=a+translate[166]}if(a){}else{$.ajax({method:"POST",url:"./modul/stundenplan/modify.php",data:{classSel:b},success:function(c){if(c){$("#error").html(c).slideDown("fast")}else{$("#saveClassButton").addClass("btn-success").removeClass("btn-default").delay(1000).slideUp("slow",function(){$("#saveClassButton").addClass("btn-default").removeClass("btn-success");$("#saveClassButton").html((translate[164]))});$("#saveClassButton").html(translate[165]+"!")}}})}})});